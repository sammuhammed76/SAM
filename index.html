<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SAM</title>
<meta name="theme-color" content="#0a84ff">
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--blue:#0a84ff;--green:#32d74b;--red:#ff3b30;--bg:#f7f8fc}
*{box-sizing:border-box}
body{font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif;margin:0;background:var(--bg);color:#111}
header{background:var(--blue);color:#fff;padding:14px;text-align:center;font-size:20px;position:sticky;top:0;z-index:2}
main{padding:16px;display:grid;gap:16px}
.card{background:#fff;border-radius:12px;padding:14px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
input,select,textarea{width:100%;padding:10px;margin:6px 0;border-radius:10px;border:1px solid #dcdcdc}
button{padding:10px 14px;border:0;border-radius:10px;background:var(--blue);color:#fff;font-weight:600}
button.ghost{background:#eef3ff;color:var(--blue)}
button.danger{background:var(--red);color:#fff}
table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
tr.profit{background:#e8fbe8}
tr.loss{background:#ffefef}
.total{background:#eef3ff;padding:10px;border-radius:10px;margin-top:8px}
.chart-container{position:relative;height:250px;width:100%}
</style>
</head>
<body>
<header>ðŸš› SAM â€” TÄ±r Takip v2.0</header>
<main>

<div class="card">
  <h3>Yeni KayÄ±t</h3>
  <input id="date" type="date">
  <input id="plate" placeholder="Plaka (Ã¶rn: 34ABC123)">
  <input id="client" placeholder="MÃ¼ÅŸteri">
  <input id="income" type="number" placeholder="Gelir (â‚º)">
  <input id="expense" type="number" placeholder="Gider (â‚º)">
  <textarea id="note" placeholder="AÃ§Ä±klama"></textarea>
  <button id="btnAdd">Kaydet</button>
</div>

<div class="card">
  <h3>Filtre & DÄ±ÅŸa Aktar</h3>
  <div class="row">
    <input id="qPlate" placeholder="Plaka ara">
    <input id="qClient" placeholder="MÃ¼ÅŸteri ara">
  </div>
  <button class="ghost" id="btnFilter">Filtrele</button>
  <button class="ghost" id="btnClear">Temizle</button>
  <button class="ghost" id="btnCsv">CSV DÄ±ÅŸa Aktar</button>
  <div class="total" id="summary"></div>
</div>

<div class="card">
  <h3>KayÄ±tlar</h3>
  <table id="table">
    <thead><tr><th>Tarih</th><th>Plaka</th><th>MÃ¼ÅŸteri</th><th>Gelir</th><th>Gider</th><th>KÃ¢r</th><th>Not</th><th></th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <h3>AylÄ±k Rapor</h3>
  <canvas id="chart"></canvas>
</div>

<script>
const LS="samDataV3"; let data=JSON.parse(localStorage.getItem(LS)||"[]");
function save(){localStorage.setItem(LS,JSON.stringify(data));}
function money(n){return (n||0).toLocaleString("tr-TR");}

function add(){
 const r={
   id:Date.now(),
   date:date.value, plate:plate.value, client:client.value,
   income:+income.value||0, expense:+expense.value||0,
   note:note.value||""
 };
 if(!r.date||!r.plate){alert("Tarih ve plaka zorunlu");return;}
 data.push(r); save(); render(); date.value=plate.value=client.value=income.value=expense.value=note.value="";
}
function del(id){if(confirm("Silinsin mi?")){data=data.filter(x=>x.id!=id);save();render();}}
function render(){
 const tb=document.querySelector("#table tbody"); tb.innerHTML="";
 let sumIn=0,sumEx=0;
 let list=[...data];
 const qp=qPlate.value.toLowerCase(),qc=qClient.value.toLowerCase();
 if(qp) list=list.filter(x=>x.plate.toLowerCase().includes(qp));
 if(qc) list=list.filter(x=>x.client.toLowerCase().includes(qc));
 list.sort((a,b)=>b.date.localeCompare(a.date));
 list.forEach(r=>{
   const k=r.income-r.expense; sumIn+=r.income; sumEx+=r.expense;
   const tr=document.createElement("tr");
   tr.className=k>=0?"profit":"loss";
   tr.innerHTML=`<td>${r.date}</td><td>${r.plate}</td><td>${r.client}</td>
   <td>${money(r.income)} â‚º</td><td>${money(r.expense)} â‚º</td>
   <td>${money(k)} â‚º</td><td>${r.note}</td>
   <td><button class="danger" onclick="del(${r.id})">Sil</button></td>`;
   tb.appendChild(tr);
 });
 summary.innerHTML=`Toplam Gelir: <b>${money(sumIn)} â‚º</b> â€” Gider: <b>${money(sumEx)} â‚º</b> â€” KÃ¢r: <b>${money(sumIn-sumEx)} â‚º</b>`;
 drawChart();
}
function drawChart(){
 const ctx=document.getElementById("chart");
 const months={};
 data.forEach(r=>{
   const [y,m]=r.date.split("-"); const key=y+"-"+m;
   if(!months[key]) months[key]={gelir:0,gider:0};
   months[key].gelir+=r.income; months[key].gider+=r.expense;
 });
 const labels=Object.keys(months).sort();
 const gelir=labels.map(k=>months[k].gelir);
 const gider=labels.map(k=>months[k].gider);
 if(window.myChart) window.myChart.destroy();
 window.myChart=new Chart(ctx,{
   type:"bar",
   data:{labels,datasets:[
     {label:"Gelir",data:gelir,backgroundColor:"rgba(50,215,75,0.6)"},
     {label:"Gider",data:gider,backgroundColor:"rgba(255,59,48,0.6)"}
   ]},
   options:{plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:true}}}
 });
}
btnAdd.onclick=add;
btnFilter.onclick=render;
btnClear.onclick=()=>{qPlate.value=qClient.value="";render();}
btnCsv.onclick=()=>{
 let rows=["Tarih,Plaka,MÃ¼ÅŸteri,Gelir,Gider,KÃ¢r,Not"];
 data.forEach(r=>rows.push(`${r.date},${r.plate},${r.client},${r.income},${r.expense},${r.income-r.expense},"${r.note}"`));
 const blob=new Blob([rows.join("\n")],{type:"text/csv"});
 const a=document.createElement("a"); a.href=URL.createObjectURL(blob);a.download="sam_kayitlar.csv";a.click();
};
render();
</script>

</main>
</body>
</html>
